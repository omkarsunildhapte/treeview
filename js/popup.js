document.addEventListener("DOMContentLoaded", function () {
  const projectsData2 = [
    {
      "GUID": "bcc8c279-2a4f-481f-ac8e-79dc4207acba",
      "BarID": "QLVN9E",
      "Name": "3D Printing",
      "TypeID": 1,
      "LVN": 3,
      "CVN": 0,
      "CreatedDate": "06-Nov-23 11:29:51 AM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "aff33340-7265-451b-9017-a0042f6cb66f",
      "BarID": "WVT1WT",
      "Name": "P1",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "14-Nov-23 4:53:51 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "a6e71bcd-8204-484a-8157-3e4abed5bcb5",
      "BarID": "U8WMIS",
      "Name": "P2",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:24 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "ae3b52b4-5402-4637-95fd-477b6ef57de1",
      "BarID": "N76WFM",
      "Name": "P3",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:43 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "bcc8c279-2a4f-481f-ac8e-79dc4207acba",
      "BarID": "QLVN9E",
      "Name": "3D Printing1",
      "TypeID": 1,
      "LVN": 3,
      "CVN": 0,
      "CreatedDate": "06-Nov-23 11:29:51 AM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "aff33340-7265-451b-9017-a0042f6cb66f",
      "BarID": "WVT1WT",
      "Name": "P4",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "14-Nov-23 4:53:51 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "a6e71bcd-8204-484a-8157-3e4abed5bcb5",
      "BarID": "U8WMIS",
      "Name": "P5",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:24 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "ae3b52b4-5402-4637-95fd-477b6ef57de1",
      "BarID": "N76WFM",
      "Name": "P6",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:43 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "bcc8c279-2a4f-481f-ac8e-79dc4207acba",
      "BarID": "QLVN9E",
      "Name": "3D Printing2",
      "TypeID": 1,
      "LVN": 3,
      "CVN": 0,
      "CreatedDate": "06-Nov-23 11:29:51 AM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "aff33340-7265-451b-9017-a0042f6cb66f",
      "BarID": "WVT1WT",
      "Name": "P7",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "14-Nov-23 4:53:51 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "a6e71bcd-8204-484a-8157-3e4abed5bcb5",
      "BarID": "U8WMIS",
      "Name": "P8",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:24 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "ae3b52b4-5402-4637-95fd-477b6ef57de1",
      "BarID": "N76WFM",
      "Name": "P9",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:43 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "bcc8c279-2a4f-481f-ac8e-79dc4207acba",
      "BarID": "QLVN9E",
      "Name": "3D Printing",
      "TypeID": 1,
      "LVN": 3,
      "CVN": 0,
      "CreatedDate": "06-Nov-23 11:29:51 AM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "aff33340-7265-451b-9017-a0042f6cb66f",
      "BarID": "WVT1WT",
      "Name": "P1",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "14-Nov-23 4:53:51 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "a6e71bcd-8204-484a-8157-3e4abed5bcb5",
      "BarID": "U8WMIS",
      "Name": "P2",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:24 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "ae3b52b4-5402-4637-95fd-477b6ef57de1",
      "BarID": "N76WFM",
      "Name": "P3",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:43 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "bcc8c279-2a4f-481f-ac8e-79dc4207acba",
      "BarID": "QLVN9E",
      "Name": "3D Printing",
      "TypeID": 1,
      "LVN": 3,
      "CVN": 0,
      "CreatedDate": "06-Nov-23 11:29:51 AM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "aff33340-7265-451b-9017-a0042f6cb66f",
      "BarID": "WVT1WT",
      "Name": "P1",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "14-Nov-23 4:53:51 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "a6e71bcd-8204-484a-8157-3e4abed5bcb5",
      "BarID": "U8WMIS",
      "Name": "P2",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:24 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "ae3b52b4-5402-4637-95fd-477b6ef57de1",
      "BarID": "N76WFM",
      "Name": "P3",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:43 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "bcc8c279-2a4f-481f-ac8e-79dc4207acba",
      "BarID": "QLVN9E",
      "Name": "3D Printing",
      "TypeID": 1,
      "LVN": 3,
      "CVN": 0,
      "CreatedDate": "06-Nov-23 11:29:51 AM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "aff33340-7265-451b-9017-a0042f6cb66f",
      "BarID": "WVT1WT",
      "Name": "P1",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "14-Nov-23 4:53:51 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "a6e71bcd-8204-484a-8157-3e4abed5bcb5",
      "BarID": "U8WMIS",
      "Name": "P2",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:24 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "ae3b52b4-5402-4637-95fd-477b6ef57de1",
      "BarID": "N76WFM",
      "Name": "P3",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:43 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "bcc8c279-2a4f-481f-ac8e-79dc4207acba",
      "BarID": "QLVN9E",
      "Name": "3D Printing",
      "TypeID": 1,
      "LVN": 3,
      "CVN": 0,
      "CreatedDate": "06-Nov-23 11:29:51 AM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "aff33340-7265-451b-9017-a0042f6cb66f",
      "BarID": "WVT1WT",
      "Name": "P1",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "14-Nov-23 4:53:51 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "a6e71bcd-8204-484a-8157-3e4abed5bcb5",
      "BarID": "U8WMIS",
      "Name": "P2",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:24 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }, {
      "GUID": "ae3b52b4-5402-4637-95fd-477b6ef57de1",
      "BarID": "N76WFM",
      "Name": "P3",
      "TypeID": 1,
      "LVN": 2,
      "CVN": 0,
      "CreatedDate": "17-Nov-23 2:37:43 PM",
      "SyncStatus": "synced",
      "Status": "Created",
    }
  ]
  const itemsPerPage = 4;
  const tableBody = document.getElementById("tableBody");
  const prevPageButton = document.getElementById("prevPage");
  const nextPageButton = document.getElementById("nextPage");
  let currentPage = 0;
  const secondJson = [
    {
      project: "Project 1",
      members: "Team 1",
      promisedDate: "2023-01-15",
      completion: "30%",
    },
    {
      project: "Project 2",
      members: "Team 2",
      promisedDate: "2023-02-01",
      completion: "50%",
    },
    {
      project: "Project 3",
      members: "Team 3",
      promisedDate: "2023-03-10",
      completion: "80%",
    },
    {
      project: "Project 4",
      members: "Team 4",
      promisedDate: "2023-04-05",
      completion: "100%",
    },
    {
      project: "Project 5",
      members: "Team 5",
      promisedDate: "2023-05-20",
      completion: "100%",
    },
    {
      project: "Project 6",
      members: "Team 6",
      promisedDate: "2023-06-15",
      completion: "100%",
    },
  ];
  const tableBody2 = document.getElementById("tableBody1");
  const tableBody1count = document.getElementById("tableBody1count");
  let completedCount = 0;
  const jsonData = [
    { category: "Projects", count: 5 },
    { category: "Jobs", count: 10 },
    { category: "Operations", count: 15 },
    { category: "Tasks", count: 20 },
  ];
  const initialData = [
    { category: "Late", count: 1 },
    { category: "Job", count: 1 },
    { category: "Operation", count: 1 },
    { category: "Task", count: 1 },
  ];
  const data = [
    { month: "January", value: 10 },
    { month: "February", value: 15 },
    { month: "March", value: 8 },
    { month: "April", value: 12 },
    { month: "May", value: 20 },
  ];
  const myChart = echarts.init(document.getElementById("barChart"));

  function updateTable(startIndex) {
    tableBody.innerHTML = "";
    for (let i = startIndex; i < startIndex + itemsPerPage && i < projectsData2.length; i++) {
      const row = document.createElement("tr");
      row.classList.add("border-0");
      row.innerHTML = `
        <td class="border-0 text-center">${projectsData2[i].Name}</td>
        <td class="border-0 text-center">${projectsData2[i].Status}</td>
        <td class="border-0 text-center" style="overflow-x: auto;width: 300px;"><span class="barcode">${projectsData2[i].BarID}</span></td>
      `;
      tableBody.appendChild(row);
    }
  }

  prevPageButton.addEventListener("click", () => {
    if (currentPage > 0) {
      currentPage--;
      updateTable(currentPage * itemsPerPage);
    }
  });

  nextPageButton.addEventListener("click", () => {
    const maxPages = Math.ceil(data.length / itemsPerPage);
    if (currentPage < maxPages - 1) {
      currentPage++;
      updateTable(currentPage * itemsPerPage);
    }
  });

  function createCard(category, count) {
    return `
      <div style="max-width: 390px;" class="card col-lg-3 col-xl-3 col-xxl-3 col-sm-12 col-12 col-md-3 mb-2 m-0">
          <div class="card-body m-0 p-0 py-3">
              <div class="row align-items-center justify-content-center">
                  <div class="col-sm-6 col-md-6 col-6 col-lg-6">
                      <span class="fw-bold text-nowrap">${category}</span>
                  </div>
                  <div class="col-sm-3 col-md-3 col-lg-3 col-3 text-end pe-4">
                      <span class="fw-bold" id="count-${category}">${count}</span>
                  </div>
                  <div class="col-sm-2 col-md-2 cursor-pointer col-lg-2 col-2 dashboard-tooltip toggle-popup px-3 py-2 text-center rounded-3" data-popup-id="popup-${category}">
                      <i class="fa fa-ellipsis-v text-white toggle-popup" data-popup-id="popup-${category}"></i>
                  </div>
              </div>
          </div>
          <div class="card popup" id="popup-${category}" style="width: 250px;position: absolute;right: 36px;top: 60px;z-index: 1; display: none;">
              <div class="card-body">
                  <ul class="list-group">
                      <li style="font-size: 12px;" class="list-group-item border-0 border rounded-3 text-center active-popup" data-category="${category}" data-popup-id="popup-${category}" data-count-id="count-${category}">All
                          ${category}</li>
                      <li style="font-size: 12px;" class="list-group-item border-0 border rounded-3 text-center active-popup" data-category="${category}" data-popup-id="popup-${category}" data-count-id="count-${category}">Created
                          ${category}</li>
                      <li style="font-size: 12px;" class="list-group-item border-0 border rounded-3 text-center active-popup" data-category="${category}" data-popup-id="popup-${category}" data-count-id="count-${category}">Work in
                          Progress ${category}
                      </li>
                      <li style="font-size: 12px;" class="list-group-item border-0 border rounded-3 text-center active-popup" data-category="${category}" data-popup-id="popup-${category}" data-count-id="count-${category}">Completed
                          ${category}</li>
                  </ul>
              </div>
          </div>
      </div>
    `;
  }

  document.addEventListener("click", function (event) {
    const target = event.target;
    document.querySelectorAll(".popup").forEach((popup) => {
      if (popup.id !== `popup-${target.dataset.category}`) {
        popup.style.display = "none";
      }
    });
    if (target.classList.contains("toggle-popup")) {
      const popupId = target.getAttribute("data-popup-id");
      const popup = document.getElementById(popupId);
      popup.style.display = popup.style.display === "none" ? "block" : "none";
    }
    if (target.classList.contains("list-group-item")) {
      const category = target.dataset.category;
      const countId = target.dataset.countId;
      const countSpan = document.getElementById(countId);
      const currentCount = parseInt(countSpan.innerText);
      countSpan.innerText = currentCount + 1;
    }
  });

  function updateDashboard(jsonData) {
    const dashboardCards = document.getElementById("dashboardCards");
    dashboardCards.innerHTML = "";
    jsonData.forEach(({ category, count }) => {
      const card = createCard(category, count);
      dashboardCards.innerHTML += card;
    });
  }

  document.addEventListener("click", function (event) {
    const target = event.target;
    if (target.classList.contains("active-popup")) {
      const popupId = target.dataset.popupId;
      const popup = document.getElementById(popupId);
      popup.style.display = "none";
    }
  });

  function updateDashboard2(jsonData) {
    const dashboardCards = document.getElementById("dashboardCards2");
    dashboardCards.innerHTML = ""; // Clear existing content

    jsonData.forEach(({ category, count }) => {
      const card = createCard(category, count);
      dashboardCards.innerHTML += card;
    });
  }

  secondJson.forEach((entry) => {
    const row = document.createElement("tr");
    row.innerHTML = `
        <td class='text-center'>${entry.project}</td>
        <td class='text-center'>${entry.members}</td>
        <td class='text-center'>${entry.promisedDate}</td>
        <td class='text-center'>${entry.completion}</td>
    `;
    if (parseInt(entry.completion) === 100) {
      completedCount++;
    }
    tableBody2.appendChild(row);
  });

  tableBody1count.textContent = completedCount;

  const option = {
    xAxis: {
      type: "category",
      data: data.map((d) => d.month),
      splitLine: {
        show: true,
      },
    },
    yAxis: {
      type: "value",
      splitLine: {
        show: true,
      },
    },
    legend: {
      data: ["Project Numbers"],
    },
    series: [
      {
        type: "bar",
        name: "Project Numbers",
        id: "sales",
        data: data.map((d) => d.value),
        itemStyle: {
          color: "#007bff",
        },
        universalTransition: {
          enabled: true,
          divideShape: "clone",
        },
      },
    ],
  };
  myChart.setOption(option);
  updateTable(currentPage * itemsPerPage);
  updateDashboard(jsonData);
  updateDashboard2(initialData);
});
